var Gallery=new Class({initialize:function(b,a){this.container=b||alert("No element ID given to Gallery constructor");this.current_image=0;this.options=a;if("array"==typeOf(a.images))this.images=a.images,window.addEvent("domready",this.create.bind(this));else if("string"==typeOf(a.images)){var c=this;(new Request.JSON({method:"get",secure:!0,encoding:"utf-8",url:a.images,onSuccess:function(d){c.images=d;window.addEvent("domready",c.create.bind(c))},onError:function(d,e){alert("Error obtaining json: "+
e)},onFailure:function(d,e){alert("Failure obtaining json: "+e)}})).get()}else alert("No recognizable list of images or URL provided")},create:function(b){document.id(this.container).addClass("gallery");var a=this;this.viewer=(new Element("div",{"class":"viewer"})).inject(this.container);var c=(new Element("div",{"class":"thumbnails",events:{mousewheel:function(d){var e=d.wheel,f=c.getScroll().x;c.scrollTo(f-40*e);d.preventDefault()}}})).inject(this.container);new Drag(c,{style:!1,invert:!0,modifiers:{x:"scrollLeft"}});
this.thumbnails=(new Element("div",{events:{"click:relay(img)":function(d,e){d=parseInt(e.get("id").substr(10));d!=a.current_image&&(a.thumbnails.getElement("img#thumbnail_"+a.current_image).removeClass("selected"),a.images[a.current_image].view={x:(a.iipmooviewer.view.x+a.iipmooviewer.view.w/2)/a.iipmooviewer.wid,y:(a.iipmooviewer.view.y+a.iipmooviewer.view.h/2)/a.iipmooviewer.hei,resolution:a.iipmooviewer.view.res},a.current_image=d,a.updateViewer(a.images[d]),e.addClass("selected"))}}})).inject(c);
this.createViewer();this.createThumbnails()},goTo:function(b){0>b||b>this.images.length||(this.thumbnails.getElement("img#thumbnail_"+this.current_image).removeClass("selected"),this.images[this.current_image].view={x:(this.iipmooviewer.view.x+this.iipmooviewer.view.w/2)/this.iipmooviewer.wid,y:(this.iipmooviewer.view.y+this.iipmooviewer.view.h/2)/this.iipmooviewer.hei,resolution:this.iipmooviewer.view.res},this.current_image=b,this.updateViewer(this.images[b]),this.thumbnails.getElement("img#thumbnail_"+
this.current_image).addClass("selected"))},createThumbnails:function(){var b=Math.floor(this.thumbnails.getParent().getSize().y)-20,a=this.thumbnails;Array.each(this.images,function(c,d){c=(new Element("img",{src:(c.server||"/fcgi-bin/iipsrv.fcgi")+"?FIF="+c.image+"&HEI="+b+"&WID="+2*b+"&CVT=JPEG",id:"thumbnail_"+d,title:c.title||null})).inject(a);0==d&&c.addClass("selected")})},createViewer:function(b){this.iipmooviewer=new IIPMooViewer(this.viewer,{server:this.images[0].server||null,image:this.images[0].image,
credit:this.images[0].caption,scale:this.images[0].scale||null,prefix:this.images[0].prefix||null,navigation:this.options.navigation||null})},updateViewer:function(b){this.server&&(this.iipmooviewer.server=b.server);this.iipmooviewer.setCredit(b.caption);this.iipmooviewer.viewport=b.view||null;this.iipmooviewer.changeImage(b.image)}});
